--- allegro/makefile.mgw.orig	Sun Dec 15 15:35:38 2002
+++ allegro/makefile.mgw	Sun Dec 15 19:37:44 2002
@@ -11,7 +11,11 @@
 # -------- define some variables that the primary makefile will use --------
 
 PLATFORM = MinGW32
+ifdef CROSSCOMPILE
+RUNNER = 
+else
 RUNNER = obj/mingw32/runner.exe
+endif
 EXE = .exe
 OBJ = .o
 HTML = html
@@ -239,7 +243,13 @@
 
 endif # STATICLINK
 
-$(MINGDIR_U)/lib/$(IMPLIB_BASENAME): $(IMPLIB_NAME)
+$(MINGDIR_U)/lib:
+	mkdir $(MINGDIR_U)/lib
+
+$(MINGDIR_U)/lib/$(DLL_BASENAME): $(MINGDIR_U)/lib
+	cp lib/mingw32/$(DLL_BASENAME) $(MINGDIR_U)/lib
+
+$(MINGDIR_U)/lib/$(IMPLIB_BASENAME): $(IMPLIB_NAME) $(MINGDIR_U)/lib
 	cp lib/mingw32/$(IMPLIB_BASENAME) $(MINGDIR_U)/lib
 
 $(MINGDIR_U)/include:
@@ -346,6 +356,8 @@
    ifndef STATICLINK
       INSTALL_FILES += $(WINDIR_U)/$(DLL_BASENAME)
    endif
+else
+      INSTALL_FILES += $(MINGDIR_U)/lib/$(DLL_BASENAME)
 endif
 
 install: $(INSTALL_FILES)
@@ -412,8 +424,8 @@
    DLLWRAP = dllwrap
    WINDRES = windres
 else
-   DLLWRAP = i386-mingw32msvc-dllwrap
-   WINDRES = i386-mingw32msvc-windres
+   DLLWRAP = i386-mingw32-dllwrap
+   WINDRES = i386-mingw32-windres
 endif
 
 ifdef STATICLINK
@@ -439,10 +451,10 @@
 COMPILE_FLAGS += $(subst src/,-DALLEGRO_SRC ,$(findstring src/, $<))$(CFLAGS)
 
 $(OBJ_DIR)/%.o: %.c
-	gcc $(COMPILE_FLAGS) -I. -I./include -o $@ -c $<
+	$(CC) $(COMPILE_FLAGS) -I. -I./include -o $@ -c $<
 
 $(OBJ_DIR)/%.o: %.s
-	gcc $(SFLAGS) -I. -I./include -x assembler-with-cpp -o $@ -c $<
+	$(CC) $(SFLAGS) -I. -I./include -x assembler-with-cpp -o $@ -c $<
 
 $(OBJ_DIR)/%.o: %.rc
 	$(WINDRES) --include-dir include -O coff -o $@ -i $<
@@ -451,19 +463,19 @@
 	$(WINDRES) -O coff -o $@ -i $<
 
 tests/win/dibsound.exe: $(OBJ_DIR)/dibsound.o obj/mingw32/dibsound.res $(IMPLIB_NAME)
-	gcc $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o tests/win/dibsound.exe $(OBJ_DIR)/dibsound.o obj/mingw32/dibsound.res $(IMPLIB_NAME) $(LIBRARIES)
+	$(CC) $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o tests/win/dibsound.exe $(OBJ_DIR)/dibsound.o obj/mingw32/dibsound.res $(IMPLIB_NAME) $(LIBRARIES)
 
 tests/win/dxwindow.exe: $(OBJ_DIR)/dxwindow.o obj/mingw32/dxwindow.res $(IMPLIB_NAME)
-	gcc $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o tests/win/dxwindow.exe $(OBJ_DIR)/dxwindow.o obj/mingw32/dxwindow.res $(IMPLIB_NAME) $(LIBRARIES)
+	$(CC) $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o tests/win/dxwindow.exe $(OBJ_DIR)/dxwindow.o obj/mingw32/dxwindow.res $(IMPLIB_NAME) $(LIBRARIES)
 
 tests/win/%.exe: $(OBJ_DIR)/%.o $(IMPLIB_NAME)
-	gcc $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o $@ $< $(IMPLIB_NAME) $(LIBRARIES)
+	$(CC) $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o $@ $< $(IMPLIB_NAME) $(LIBRARIES)
 
 tests/win/scrsave.scr: $(OBJ_DIR)/scrsave.o obj/mingw32/scrsave.res $(IMPLIB_NAME)
-	gcc $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o tests/win/scrsave.scr $(OBJ_DIR)/scrsave.o obj/mingw32/scrsave.res $(IMPLIB_NAME) $(LIBRARIES)
+	$(CC) $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o tests/win/scrsave.scr $(OBJ_DIR)/scrsave.o obj/mingw32/scrsave.res $(IMPLIB_NAME) $(LIBRARIES)
 
 tools/win/%.exe: $(OBJ_DIR)/%.o $(IMPLIB_NAME)
-	gcc $(LFLAGS) $(PFLAGS) -Wl,--subsystem,console -o $@ $< $(IMPLIB_NAME) $(LIBRARIES)
+	$(CC) $(LFLAGS) $(PFLAGS) -Wl,--subsystem,console -o $@ $< $(IMPLIB_NAME) $(LIBRARIES)
 
 ifndef CROSSCOMPILE
 
@@ -484,8 +496,14 @@
    endif
 endif
 
+ifdef CROSSCOMPILE
+demo/demo.exe: $(IMPLIB_NAME)
+	$(CC) $(COMPILE_FLAGS) -I. -I./include -o $(OBJ_DIR)/demo.o -c ./demo/demo.c
+	$(CC) $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o demo/demo.exe $(OBJ_DIR)/demo.o $(IMPLIB_NAME) $(LIBRARIES)
+else
 demo/demo.exe: $(OBJ_DIR)/demo.o obj/mingw32/demo.res $(IMPLIB_NAME)
-	gcc $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o demo/demo.exe $(OBJ_DIR)/demo.o obj/mingw32/demo.res $(IMPLIB_NAME) $(LIBRARIES)
+	$(CC) $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o demo/demo.exe $(OBJ_DIR)/demo.o obj/mingw32/demo.res $(IMPLIB_NAME) $(LIBRARIES)
+endif
 
 obj/mingw32/setupdat.s: setup/setup.dat tools/dat2s.exe
 ifdef STATICLINK
@@ -505,49 +523,52 @@
 endif
 
 obj/mingw32/setupdat.o: obj/mingw32/setupdat.s
-	gcc -o obj/mingw32/setupdat.o -c obj/mingw32/setupdat.s
+	$(CC) -o obj/mingw32/setupdat.o -c obj/mingw32/setupdat.s
 
 $(OBJ_DIR)/setup.o: setup/setup.c
-	gcc $(COMPILE_FLAGS) -DSETUP_USE_COMPILED_DATAFILES -I. -I./include -o $(OBJ_DIR)/setup.o -c setup/setup.c
+	$(CC) $(COMPILE_FLAGS) -DSETUP_USE_COMPILED_DATAFILES -I. -I./include -o $(OBJ_DIR)/setup.o -c setup/setup.c
 
 setup/setup.exe: $(OBJ_DIR)/setup.o obj/mingw32/setupdat.o $(IMPLIB_NAME)
-	gcc $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o setup/setup.exe $(OBJ_DIR)/setup.o obj/mingw32/setupdat.o $(IMPLIB_NAME) $(LIBRARIES)
+	$(CC) $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o setup/setup.exe $(OBJ_DIR)/setup.o obj/mingw32/setupdat.o $(IMPLIB_NAME) $(LIBRARIES)
 
 endif
 
 */%.exe: $(OBJ_DIR)/%.o $(IMPLIB_NAME)
-	gcc $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o $@ $< $(IMPLIB_NAME) $(LIBRARIES)
+	$(CC) $(LFLAGS) $(PFLAGS) -Wl,--subsystem,windows -o $@ $< $(IMPLIB_NAME) $(LIBRARIES)
 
 LINK_CONSOLE_DEPS = $(IMPLIB_NAME)
 
 define LINK_CONSOLE
-   gcc $(LFLAGS) $(PFLAGS) -Wl,--subsystem,console -o $@ $< $(IMPLIB_NAME) $(LIBRARIES)
+   $(CC) $(LFLAGS) $(PFLAGS) -Wl,--subsystem,console -o $@ $< $(IMPLIB_NAME) $(LIBRARIES)
 endef
 
 ifdef CROSSCOMPILE
 
 obj/mingw32/asmdef.s: src/i386/asmdef.c include/*.h include/allegro/*.h obj/mingw32/asmcapa.h
-	gcc $(WFLAGS) -I. -I./include -S -o obj/mingw32/asmdef.s src/i386/asmdef.c
+	$(CC) $(WFLAGS) -I. -I./include -S -o obj/mingw32/asmdef.s src/i386/asmdef.c
 
 obj/mingw32/asmdef.inc: obj/mingw32/asmdef.s
 	if [ ! -x misc/asmdef.sh ]; then chmod a+x misc/asmdef.sh; fi
 	misc/asmdef.sh obj/mingw32/asmdef.s obj/mingw32/asmdef.inc
 
+$(RUNNER):
+	
+
 else
 
 obj/mingw32/asmdef.inc: obj/mingw32/asmdef.exe
 	obj/mingw32/asmdef.exe obj/mingw32/asmdef.inc
 
 obj/mingw32/asmdef.exe: src/i386/asmdef.c
-	gcc -O $(WFLAGS) $(PFLAGS) -I. -I./include -o obj/mingw32/asmdef.exe src/i386/asmdef.c
+	$(CC) -O $(WFLAGS) $(PFLAGS) -I. -I./include -o obj/mingw32/asmdef.exe src/i386/asmdef.c
 
-obj/mingw32/runner.exe: src/misc/runnergw.c
-	gcc -O -Wall -Werror -o obj/mingw32/runner.exe src/misc/runnergw.c
+$(RUNNER): src/misc/runnergw.c
+	$(CC) -O -Wall -Werror -o obj/mingw32/runner.exe src/misc/runnergw.c
 
 endif # CROSSCOMPILE
 
 define LINK_WITHOUT_LIB
-   gcc $(LFLAGS) $(PFLAGS) -Wl,--subsystem,console -o $@ $^
+   $(CC) $(LFLAGS) $(PFLAGS) -Wl,--subsystem,console -o $@ $^
 endef
 
 PLUGIN_LIB = lib/mingw32/lib$(VERY_SHORT_VERSION)dat.a
@@ -584,10 +605,10 @@
 DEPEND_PARAMS = -MM -MG -I. -I./include -DSCAN_DEPEND -DALLEGRO_MINGW32
 
 depend:
-	gcc $(DEPEND_PARAMS) src/*.c src/c/*.c src/i386/*.c src/misc/*.c src/win/*.c demo/*.c > _depend.tmp
-	gcc $(DEPEND_PARAMS) docs/src/makedoc/*.c examples/*.c setup/*.c tests/*.c tests/win/*.c >> _depend.tmp
-	gcc $(DEPEND_PARAMS) tools/*.c tools/win/*.c tools/plugins/*.c >> _depend.tmp
-	gcc $(DEPEND_PARAMS) -x assembler-with-cpp src/c/*.s src/i386/*.s src/misc/*.s src/win/*.s >> _depend.tmp
+	$(CC) $(DEPEND_PARAMS) src/*.c src/c/*.c src/i386/*.c src/misc/*.c src/win/*.c demo/*.c > _depend.tmp
+	$(CC) $(DEPEND_PARAMS) docs/src/makedoc/*.c examples/*.c setup/*.c tests/*.c tests/win/*.c >> _depend.tmp
+	$(CC) $(DEPEND_PARAMS) tools/*.c tools/win/*.c tools/plugins/*.c >> _depend.tmp
+	$(CC) $(DEPEND_PARAMS) -x assembler-with-cpp src/c/*.s src/i386/*.s src/misc/*.s src/win/*.s >> _depend.tmp
 	sed -e "s/^[a-zA-Z0-9_\/]*\///" _depend.tmp > _depend2.tmp
 ifdef UNIX_TOOLS
 	sed -e "s/^\([a-zA-Z0-9_]*\)\.o:/obj\/mingw32\/alleg\/\1\.o:/" _depend2.tmp > obj/mingw32/alleg/makefile.dep
